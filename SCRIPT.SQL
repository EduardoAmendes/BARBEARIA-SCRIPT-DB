CREATE DATABASE BARBER;

USE BARBER;

CREATE TABLE USUARIO(
ID_USUARIO INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
NOME_PROFISSIONAL VARCHAR(50) NOT NULL,
LOGIN VARCHAR(100) NOT NULL,
SENHA VARCHAR(100) NOT NULL,
ADMIN ENUM('S','N') NOT NULL,
ATIVO ENUM('S','N') NOT NULL,
DATA_CRIACAO DATETIME NOT NULL DEFAULT NOW(),
FK_IDLOJA INT(10)
);

CREATE TABLE ENDERECO(
ID_ENDERECO INT(100) PRIMARY KEY NOT NULL AUTO_INCREMENT,
ESTADO CHAR(2) NOT NULL,
MUNICIPIO VARCHAR(20) NOT NULL,
BAIRRO VARCHAR(20) NOT NULL,
RUA VARCHAR(20) NOT NULL,
NUMERO INT(5) NOT NULL,
CEP CHAR(8)
);


CREATE TABLE MODULO(
ID_MODULO INT(100) NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOME_MODULO VARCHAR(100) NOT NULL,
VALOR_MODULO FLOAT(10,2) NOT NULL,
FK_IDLOJA INT(10)
);


CREATE TABLE AGENDAMENTO(
ID_AGENDAMENTO INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
NOME_CLIENTE VARCHAR(50) NOT NULL,
CELULAR_CLIENTE CHAR(12) NOT NULL,
MODULO VARCHAR(100),
DATA_AGD DATETIME,
VALOR FLOAT(10,2) NOT NULL,
STATUS_PED ENUM('PENDENTE', 'AGENDADO'),
PROFISIONAL VARCHAR(50),
FK_IDLOJA INT(10)
);

CREATE TABLE CADASTRO(
ID_LOJA INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
NOME_LOJA VARCHAR(100) NOT NULL,
CPF CHAR(13) NOT NULL,
CNPJ CHAR(15) NOT NULL,
NOME VARCHAR(100) NOT NULL,
SOBRENOME VARCHAR(100)
);

CREATE TABLE CONTATO(
ID_CONTATO INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
EMAIL VARCHAR(100) NOT NULL,
TELEFONE VARCHAR(20) NOT NULL,
TIPO_CEL ENUM("COM", "RES", "PRIV")
);

CREATE TABLE CADCON(
ID_LOJA INT,
ID_CONTATO INT,
PRIMARY KEY(ID_LOJA, ID_CONTATO)
);

CREATE TABLE CADEN(
ID_LOJA INT,
ID_ENDERECO INT,
PRIMARY KEY(ID_LOJA, ID_ENDERECO)
);

ALTER TABLE USUARIO 
ADD CONSTRAINT FK_USUARIO_LOJA
FOREIGN KEY(FK_IDLOJA)
REFERENCES CADASTRO(ID_LOJA);

ALTER TABLE MODULO 
ADD CONSTRAINT FK_MODULO_LOJA
FOREIGN KEY (FK_IDLOJA)
REFERENCES CADASTRO(ID_LOJA);

ALTER TABLE AGENDAMENTO
ADD CONSTRAINT FK_AGENDAMENTO_LOJA
FOREIGN KEY (FK_IDLOJA)
REFERENCES CADASTRO(ID_LOJA);


###########################################

INSERT INTO CADASTRO VALUES(
    NULL, "ADM", "12345678910", "000000000000", "EDUARDO", "MENDES" 
);

INSERT INTO USUARIO VALUES(
    NULL, "EDUARDO.MENDES", "123456", "S", "S", NOW(), 1
);

INSERT INTO ENDERECO VALUES(
    NULL, "ES", "VILA VELHA", "BAIRRO", "ITAPINA", "100", "29112540"
);

INSERT INTO MODULO VALUES(
    NULL, "BARBA", 10.00, 1
);

INSERT INTO CONTATO VALUES(
    NULL, "EFIASN@GMAIL.COM", "0279999999", "PRIV"
);

INSERT INTO CADCON VALUES(
    1, 1
);

INSERT INTO CADEN VALUES(
    1, 1
);

INSERT INTO AGENDAMENTO VALUES(
    NULL, "TESTE", "0279484141",
        (SELECT NOME_MODULO FROM MODULO WHERE ID_MODULO = 1),
    NOW(),
        (SELECT VALOR_MODULO FROM MODULO WHERE ID_MODULO = 1),
    "PENDENTE", NULL, 1
);

SELECT * FROM USUARIO;
SELECT * FROM MODULO;
SELECT * FROM AGENDAMENTO;
SELECT * FROM CADEN;
SELECT * FROM CADCON;
SELECT * FROM ENDERECO;
SELECT * FROM CADASTRO;
SELECT * FROM CONTATO;

###########################################
